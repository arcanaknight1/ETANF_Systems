---
title: "Systems Analytics"
author: "Andrew Olson"
date: "October 10, 2018"
output: html_document
---

```{r setup, include=FALSE}
# Loading libraries needed for analysis
library(ggplot2)
library(glmnet)
library(pROC)
library(plyr)
library(dplyr)
library(randomForest)
library(margins)
library(party)
library(leaps)

#loading data and redefining "-" symbols as NA
ETANFload <- read.table("Data_Analysis_Spreadsheet.csv", header = TRUE, sep = ",", na.strings = "-")
#Removing unused Employment training variable
ETANFdata <- ETANFload[, c(1:16, 18, 19)]
#converting med_income from factor
ETANFdata$Med_Income <- as.numeric(ETANFload$Med_Income)

#Set seed
set.seed(1234)

```



```{r}
### Variable selection

#subsetting data to remove extra location descriptors & missing records from dependent & Independent variables for variable selection
etanf.x <- na.omit(ETANFdata[, c(3,5:18)])

# fit the random forest
# rf1 <- cforest(ETANF ~ ., data= etanf.x, control=cforest_unbiased(mtry=2,ntree=20))

# AIC by crossvalidation for each variable selection method
testCV <- function(DATA){
  # combine two columns
  func.data <- data.frame(DATA)
  # Count the number of row of entire dataframe
  n.data <- nrow(func.data)
  # divide the number of rows in the dataframe into 8 groups
  folds <- split(sample(n.data, n.data ,replace=FALSE), as.factor(1:8))
    # aic list
    step.forward.aic <- rep(0,8)
    step.backward.aic <- rep(0,8)
    result<- data.frame("method" = character(), "aic" = numeric(), stringsAsFactors = FALSE)
  for (j in 1:8){
      test.data <- func.data[folds[[j]], ]
      n.test <-nrow(test.data)
      train.data <- func.data[-folds[[j]], ]
         #forward stepwise model
      null = glm(ETANF~1, data = na.omit(train.data), family = "poisson")
      full = glm(ETANF~., data = na.omit(train.data), family = "poisson")
      fwd.model <- step(null, scope = list(lower = null, upper = full), direction = "forward", trace = FALSE)
      step.forward.aic[j] <- AIC(fwd.model)
        #backward stepwise model
      bwd.model <- step(full, direction = "backward", trace = FALSE)
      step.backward.aic [j] <- AIC(bwd.model)
  }
    result <- rbind(result, data.frame(method = "forward", auc = mean(step.forward.aic)))
    result <- rbind(result, data.frame(method = "backward", auc = mean(step.backward.aic)))
    return(result)
}

testCV(etanf.x)

#Counting predictors for backward selection
null = glm(ETANF~1, data = etanf.x, family = "poisson")
full = glm(ETANF~., data = etanf.x, family = "poisson")
bwd.model <- bwd.model <- step(full, direction = "backward", trace = FALSE)
bwd.model
```
